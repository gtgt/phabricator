version: '2'
services:
  phabricator:
    build: ./
    image: phabricator/phabricator
    container_name: phabricator
    restart: unless-stopped
    volumes:
       - config:/var/www/phabricator/conf/local
       - repo:/var/repo
       - /etc/resolv.conf:/etc/resolv.conf
    ports:
       - 80:80
       - 443:443
       - 22:22
    environment:
      GIT_SSL_NO_VERIFY: 1
    network_mode: bridge
    depends_on:
      - database
      - daemon
  daemon:
    build:
      context: ./
      dockerfile: Dockerfile.daemon
    image: phabricator/daemon
    container_name: phabricator_daemon
    restart: unless-stopped
    network_mode: bridge
    volumes:
      - config:/var/www/phabricator/conf/local
      - repo:/var/repo
      - /etc/resolv.conf:/etc/resolv.conf
    environment:
      GIT_SSL_NO_VERIFY: 1
    depends_on:
      - database
  database:
    build:
      context: ./
      dockerfile: Dockerfile.database
    image: phabricator/database
    container_name: phabricator_db
    restart: unless-stopped
    volumes:
      - dbconfig:/etc/mysql
      - dbdata:/var/lib/mysql
    ports:
      - 3366:3306
    environment:
      MYSQL_ROOT_PASSWORD: Iesu8Withahdeeg1
    network_mode: bridge
volumes:
  config:
    driver: local
  repo:
    driver: local
  dbconfig:
    driver: local
  dbdata:
    driver: local
